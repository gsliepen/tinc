digraph finite_state_machine {

	node [shape = doublecircle];
	start [ label = "start" ];
	
	node [shape = circle];
	probes [ label = "probing" ];
	w_probes [ label = "waiting\nfor probes" ];

	ping [ label = "pinging" ];
	w_ping [ label = "waiting\nfor ping" ];
	to_ping [ label = "ping\ntimeout" ];
	
    start -> probes [ label = "/counter = 0 && minmtu = 0" ];
    probes -> w_probes [ label = "/send burst\n&& counter++" ];
    w_probes -> probes [ label = "1 second passes/" ];
    w_probes -> w_probes [ label = "received probe/set minmtu" ];
    probes -> ping [ label = "counter >= 10\n&& !minmtu/" ];
    probes -> ping [ label = "counter < 30\n&& minmtu >= maxmtu\n|| counter == 30/set mtu" ];
    
    ping -> w_ping [ label = "/send burst", weight = 3 ];
    w_ping -> to_ping [ label = "ping interval passes/\nsend burst" ];
    w_ping -> ping [ label = "receive ping\n&& ping interval passes/\nset minmtu" ];
    to_ping -> ping [ label = "ping timeout passes\n&& !minmtu/" ];
    to_ping -> start [ label = "ping timeout passes\n&& minmtu/" ];
    to_ping -> to_ping [ label = "receive ping/set minmtu" ];
}

