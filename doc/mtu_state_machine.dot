digraph finite_state_machine {

	node [shape = doublecircle];
	start [ label = "start" ];
	
	node [shape = circle];
	probes [ label = "probing" ];
	w_probes [ label = "waiting\nfor probes" ];

	ping [ label = "pinging" ];
	w_ping [ label = "wait ping\ninterval" ];
	to_ping [ label = "ping\ntimeout" ];
	
    start -> probes [ label = "/counter = 0 && minmtu = 0" ];
    probes -> w_probes [ label = "/send burst\n&& counter++" ];
    w_probes -> probes [ label = "1 second passes/" ];
    w_probes -> w_probes [ label = "received probe/set minmtu" ];
    probes -> ping [ label = "counter >= 10\n&& !minmtu/" ];
    probes -> ping [ label = "counter < 30\n&& minmtu >= maxmtu\n|| counter == 30/set mtu" ];
    
    ping -> to_ping [ label = "/send burst" ];
    w_ping -> ping [ label = "ping interval passes/" ];
    to_ping -> w_ping [ label = "ping timeout passes\n&& !minmtu/" ];
    to_ping -> start [ label = "ping timeout passes\n&& minmtu/", weight = 2 ];
    to_ping -> w_ping [ label = "ping received/\nset minmtu" ];
    to_ping -> probes [ label = "ping received\n&& ping mtu > maxmtu/\ncounter = 10\n&& maxmtu = MTU" ];
    w_ping -> probes [ label = "ping received\n&& ping mtu > maxmtu/\ncounter = 10\n&& maxmtu = MTU" ];
    w_ping -> w_ping [ label = "ping received/\nset minmtu" ];
}

